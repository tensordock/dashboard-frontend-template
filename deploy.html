<!DOCTYPE html>
<html lang="en">
  <script src="https://js.stripe.com/v3/"></script>
  <meta charset="UTF-8">
  <title>Deploy a Server</title>
  <link
    rel="preconnect" href="https://fonts.gstatic.com">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700%7cPoppins:300,400,500,600,700,800,900&amp;display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="static/css/theme.bundle.css" />
  <link rel="stylesheet" href="./static/css/custom.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script>
    const stripe = Stripe('pk_live_51JqNQYHSshR0IOtvfpFJ335VCKxHeyzKzGT8XaWMNvt5ye74VXApsofamVwZN3Ec2H9Y9Ap5WsVlVwxgnEL1Ys7R00rbTg3ky9');
  </script>

  <body>
    <main>
      <div class="container" data-layout="container">
        <nav
          class="navbar navbar-light navbar-vertical navbar-expand-xl">
          <script>
                var navbarStyle = localStorage.getItem("navbarStyle");
                if (navbarStyle && navbarStyle !== 'transparent') {
                  document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                }
              </script>
          <div class="d-flex align-items-center">
            <a class="navbar-brand" href="/home">
              <div class="d-flex align-items-center py-3">
                  <span class="font-sans-serif text-primary">GPUfleet</span>
              </div>
            </a>
          </div>
          <div class="collapse navbar-collapse" id="navbarVerticalCollapse">
            <div class="navbar-vertical-content scrollbar">
              <ul class="navbar-nav flex-column mb-3"
                id="navbarVerticalNav">
                <li class="nav-item">
                    <a class="nav-link" href="/home" role="button">
                        <div
                          class="d-flex align-items-center"><span class="nav-link-icon"><svg class="svg-inline--fa fa-globe fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="globe" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg><!-- <span class="fas fa-globe"></span> Font Awesome fontawesome.com --></span>
                            Home
                        </div>
                    </a>
                    <a class="nav-link" href="/list" role="button">
                        <div
                          class="d-flex align-items-center"><span class="nav-link-icon"><svg class="svg-inline--fa fa-window-restore fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="window-restore" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M464 0H144c-26.5 0-48 21.5-48 48v48H48c-26.5 0-48 21.5-48 48v320c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-96 464H48V256h320v208zm96-96h-48V144c0-26.5-21.5-48-48-48H144V48h320v320z"></path></svg><!-- <span class="far fa-window-restore"></span> Font Awesome fontawesome.com --></span>
                            Virtual machines
                        </div>
                    </a>
                    <a class="nav-link" href="/account" role="button">
                        <div
                            class="d-flex align-items-center"><span class="nav-link-icon"><svg class="svg-inline--fa fa-user fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg><!-- <span class="fas fa-user"></span> Font Awesome fontawesome.com --></span>
                            Account
                        </div>
                    </a>
                    <a class="nav-link" href="/deploy" role="button">
                        <div class="d-flex align-items-center">
                            <span class="nav-link-icon">
                                <svg class="svg-inline--fa fa-rocket fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rocket" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                                    <path fill="currentColor" d="M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z">
                                    </path>
                                </svg><!-- <span class="fas fa-rocket"></span> Font Awesome fontawesome.com -->
                            </span>Deploy servers
                        </div>
                    </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>

        <!-- Main Content -->

        <div class="content">
          <nav class="navbar navbar-light navbar-glass navbar-top navbar-expand">
            <a class="navbar-brand me-1 me-sm-3" href="../../index.html">
              <div class="d-flex align-items-center">
                <span class="font-sans-serif text-primary">GPUfleet</span>
              </div>
            </a>
            <ul class="navbar-nav navbar-nav-icons ms-auto flex-row align-items-center">
              <li class="nav-item dropdown">
                <a
                  class="nav-link pe-0 ps-2"
                  id="navbarDropdownUser"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true"
                >
                  <svg class="svg-inline--fa fa-user-circle fa-w-16 text-900 fs-6" aria-hidden="true" focusable="false" data-prefix="far" data-icon="user-circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                </a>
                <div
                  class="dropdown-menu dropdown-caret dropdown-menu-end py-0"
                  aria-labelledby="navbarDropdownUser"
                  data-popper="static"
                >
                  <div class="bg-white dark__bg-1000 rounded-2 py-2">
                    <a class="dropdown-item" href="/account">Account</a>
                    <a class="dropdown-item" href="#" onclick="document.cookie='whitelabelToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'; window.location.href='/home'">Logout</a>
                  </div>
                </div>
              </li>
            </ul>
          </nav>
          <div class="card overflow-hidden mb-3">
            <div class="card-body position-relative">
              <h6 class="text-600">Starting from $0.50/hour</h6>
              <h2>Deploy a new cloud GPU</h2>
              <p>
                Customize your own server, fully a la carte. Deploy in 2 tier 3
                data centers in the US and EU.
                <a class="btn btn-link ps-0 btn-sm" href="/support.html"> Have
                  questions? Chat with us</a>
              </p>
            </div>
          </div>
          <div>
            <div class="row">
              <div class="col">
                <div class="card card-border border-success shadow mb-3">
                  <div class="card-header">
                    <div class="row flex-between-end">
                      <div class="col-auto align-self-center">
                        <h4 class="mb-0">Select an available GPU</h4>
                      </div>
                    </div>
                  </div>
                  <div class="card-body pt-0">
                    <div class="list-group list-group-flush">
                      <div>
                        <p>
                          Unavailable GPU models are not shown. Need a custom
                          deployment? <a
                            href="/support.html">Contact us</a>.
                        </p>
                        <div
                          style="overflow-x: scroll; flex-wrap: no-wrap; display: flex; gap: 16px">
                          <div class="col-auto d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 gpu-select mb-3"
                              id="chooseGPUL4048GBPCIE"
                              href="javascript:chooseGPU('L40 48GB PCIE')">
                              <div class="card-body">
                                <p>
                                  L40
                                  <span
                                    class="badge badge-subtle-primary">48GB</span>
                                </p>
                                <p class="fs-10">Unprecedented visual AI</p>
                                <small>From $1.05/hour</small>
                              </div>
                            </a>
                          </div>

                          <div class="col-auto d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 gpu-select mb-3"
                              id="chooseGPUV10016GBSXM2"
                              href="javascript:chooseGPU('V100 16GB SXM2')">
                              <div class="card-body">
                                <p>
                                  V100 SXM2
                                  <span
                                    class="badge badge-subtle-primary">16GB</span>
                                </p>
                                <p class="fs-10">Longtime standard AI GPU</p>
                                <small>From $0.22/hour</small>
                              </div>
                            </a>
                          </div>

                          <div class="col-auto d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 gpu-select mb-3"
                              id="chooseGPURTXA600048GB"
                              href="javascript:chooseGPU('RTX A6000 48GB')">
                              <div class="card-body">
                                <p>
                                  RTX A6000 / A40
                                  <span
                                    class="badge badge-subtle-primary">48GB</span>
                                </p>
                                <p class="fs-10">Powerful visual computing</p>
                                <small>From $0.47/hour</small>
                              </div>
                            </a>
                          </div>
                          <div class="col-auto d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 gpu-select mb-3"
                              id="chooseGPURTXA500024GB"
                              href="javascript:chooseGPU('RTX A5000 24GB')">
                              <div class="card-body">
                                <p>
                                  RTX A5000
                                  <span
                                    class="badge badge-subtle-primary">24GB</span>
                                </p>
                                <p class="fs-10">Strong price-to-performance</p>
                                <small>From $0.21/hour</small>
                              </div>
                            </a>
                          </div>
                          <div class="col-auto d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 gpu-select mb-3"
                              id="chooseGPURTXA400016GB"
                              href="javascript:chooseGPU('RTX A4000 16GB')">
                              <div class="card-body">
                                <p>
                                  RTX A4000
                                  <span
                                    class="badge badge-subtle-primary">16GB</span>
                                </p>
                                <p class="fs-10">Cost-effective visual AI</p>
                                <small>From $0.13/hour</small>
                              </div>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="d-flex col">
                    <div
                      class="card card-border border-success shadow mb-3 w-100">
                      <div class="card-header">
                        <div class="row flex-between-end">
                          <div class="col-auto align-self-center">
                            <h4 class="mb-0">GPU Count</h4>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="list-group list-group-flush">
                          <div class="list-group-item">
                            <div class="form-group">
                              <select class="form-control form-control-sm"
                                data-style="btn btn-link" id="selectGPUCount">
                                <option id="gpuCountOption1">1</option>
                                <option id="gpuCountOption2">2</option>
                                <option id="gpuCountOption3">3</option>
                                <option id="gpuCountOption4">4</option>
                                <option id="gpuCountOption5">5</option>
                                <option id="gpuCountOption6">6</option>
                                <option id="gpuCountOption7">7</option>
                                <option id="gpuCountOption8">8</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex col">
                    <div
                      class="card card-border border-success shadow mb-3 w-100">
                      <div class="card-header">
                        <div class="row flex-between-end">
                          <div class="col-auto align-self-center">
                            <h4 class="mb-0">RAM Amount</h4>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="list-group list-group-flush">
                          <div class="list-group-item">
                            <div class="form-group">
                              <select class="form-control form-control-sm"
                                data-style="btn btn-link" id="selectRAM">
                                <option>4</option>
                                <option>6</option>
                                <option>8</option>
                                <option>10</option>
                                <option>12</option>
                                <option>16</option>
                                <option>20</option>
                                <option>24</option>
                                <option>30</option>
                                <option>32</option>
                                <option>48</option>
                                <option>61</option>
                                <option>64</option>
                                <option>100</option>
                                <option>112</option>
                                <option>120</option>
                                <option>128</option>
                                <option>160</option>
                                <option>240</option>
                                <option>256</option>
                                <option>300</option>
                                <option>366</option>
                                <option>384</option>
                                <option>492</option>
                                <option>640</option>
                                <option>768</option>
                                <option>896</option>
                                <option>940</option>
                                <option>1420</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex col">
                    <div
                      class="card card-border border-success shadow mb-3 w-100">
                      <div class="card-header">
                        <div class="row flex-between-end">
                          <div class="col-auto align-self-center">
                            <h4 class="mb-0">vCPU Count</h4>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="list-group list-group-flush">
                          <div class="list-group-item">
                            <div class="form-group">
                              <select class="form-control form-control-sm"
                                data-style="btn btn-link" id="selectvCPU">
                                <option>2</option>
                                <option>4</option>
                                <option>6</option>
                                <option>8</option>
                                <option>10</option>
                                <option>12</option>
                                <option>14</option>
                                <option>16</option>
                                <option>20</option>
                                <option>24</option>
                                <option>28</option>
                                <option>32</option>
                                <option>36</option>
                                <option>40</option>
                                <option>44</option>
                                <option>46</option>
                                <option>60</option>
                                <option>94</option>
                                <option>104</option>
                                <option>128</option>
                                <option>254</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex col">
                    <div
                      class="card card-border border-success shadow mb-3 w-100">
                      <div class="card-header">
                        <div class="row flex-between-end">
                          <div class="col-auto align-self-center">
                            <h4 class="mb-0">NVMe SSD</h4>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="list-group list-group-flush">
                          <div class="list-group-item">
                            <div class="form-group">
                              <select class="form-control form-control-sm"
                                data-style="btn btn-link"
                                id="selectStorageSpace">
                                <option value="20">20 GB</option>
                                <option value="30">30 GB</option>
                                <option value="40">40 GB</option>
                                <option value="50">50 GB</option>
                                <option value="60">60 GB</option>
                                <option value="70">70 GB</option>
                                <option value="80">80 GB</option>
                                <option value="90">90 GB</option>
                                <option value="100">100 GB</option>
                                <option value="150">150 GB</option>
                                <option value="200">200 GB</option>
                                <option value="300">300 GB</option>
                                <option value="400">400 GB</option>
                                <option value="500">500 GB</option>
                                <option value="600">600 GB</option>
                                <option value="700">700 GB</option>
                                <option value="800">800 GB</option>
                                <option value="900">900 GB</option>
                                <option value="1000">1 TB</option>
                                <option value="1200">1.2 TB</option>
                                <option value="1400">1.4 TB</option>
                                <option value="1600">1.6 TB</option>
                                <option value="1800">1.8 TB</option>
                                <option value="2000">2 TB</option>
                                <option value="2500">2.5 TB</option>
                                <option value="3000">3 TB</option>
                                <option value="3500">3.5 TB</option>
                                <option value="4000">4 TB</option>
                                <option value="4500">4.5 TB</option>
                                <option value="5000">5 TB</option>
                                <option value="5500">5.5 TB</option>
                                <option value="6000">6 TB</option>
                                <option value="6500">6.5 TB</option>
                                <option value="7000">7 TB</option>
                                <option value="7500">7.5 TB</option>
                                <option value="8000">8 TB</option>
                                <option value="8500">8.5 TB</option>
                                <option value="9000">9 TB</option>
                                <option value="9500">9.5 TB</option>
                                <option value="10000">10 TB</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card card-border border-success shadow mb-3">
                  <div class="card-header">
                    <h4 class="mb-0">6. Select a location</h4>
                  </div>
                  <div class="card-body">
                    <div class="list-group list-group-flush">
                      <div class="list-group-item pt-0">
                        <div class="row">
                          <div
                            class="col-xxl border border-primary mb-3 pt-3 rounded-left">
                            <h5>
                              Available
                              <span id="locationSelectHeader"></span> servers
                            </h5>
                            <p>With at least the requested resources</p>
                            <div class="row" id="hostnodeOptionsRow"></div>
                            <div id="hostnodeOptionsRowLoading"
                              class="d-flex justify-content-center w-100 pt-6 pb-6">
                              <div class="spinner-border text-secondary"
                                role="status">
                                <span class="sr-only">Loading...</span>
                              </div>
                            </div>
                          </div>
                          <div
                            class="col-xxl border mb-3 pt-3 rounded-right"
                            style="overflow: scroll">
                            <h5>Alternative in-stock GPUs</h5>
                            <p>Scroll to view more...</p>
                            <div class="row"
                              id="hostnodeOptionsRowSuggestions"></div>
                            <div id="hostnodeOptionsRowSuggestionsLoading"
                              class="d-flex justify-content-center w-100 pt-3 pb-6">
                              <div class="spinner-border text-secondary"
                                role="status">
                                <span class="sr-only">Loading</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card card-border border-success shadow mb-3">
                  <div class="card-header">
                    <!-- Heading -->
                    <h4 class="mb-0">7. Select an operating system</h4>
                  </div>
                  <div class="card-body">
                    <div class="list-group list-group-flush">
                      <div class="list-group-item">
                        <p class="fs-10">
                          Operating system templates updated on July 7, 2023.
                          Check out our
                          <a
                            href="https://docs.tensordock.com/cloud-gaming/gaming-via-parsec"
                            target="_blank">Windows 10 Parsec cloud gaming
                            article</a>
                          if this will apply for you.
                        </p>
                        <div class="row">
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSTensorML20.04LTSTensorFlow"
                              href="javascript:chooseOS('TensorML 20.04 LTS TensorFlow')">
                              <div class="card-body">
                                <p>
                                  Ubuntu 20 TensorFlow
                                  <i class="fab fa-ubuntu"></i>&nbsp;<span
                                    class="badge badge-subtle-primary">ML /
                                    AI</span>
                                </p>
                                <p class="fs-10">Jupyter, TensorFlow, Keras,
                                  CUDA, 30GB size<br /><em>Requires 40GB+
                                    disk</em></p>
                                <small>Included</small>
                              </div>
                            </a>
                          </div>
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSTensorML20.04LTSPyTorch"
                              href="javascript:chooseOS('TensorML 20.04 LTS PyTorch')">
                              <div class="card-body">
                                <p>
                                  Ubuntu 20 PyTorch
                                  <i class="fab fa-ubuntu"></i>&nbsp;<span
                                    class="badge badge-subtle-primary">ML /
                                    AI</span>
                                </p>
                                <p class="fs-10">
                                  Jupyter, PyTorch, CUDA, 30GB size<br />
                                  <em>Requires 40GB+ disk</em>
                                </p>
                                <small>Included</small>
                              </div>
                            </a>
                          </div>
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSTensorML20.04LTSEverything"
                              href="javascript:chooseOS('TensorML 20.04 LTS Everything')">
                              <div class="card-body">
                                <p>
                                  Ubuntu 20 Everything
                                  <i class="fab fa-ubuntu"></i>&nbsp;<span
                                    class="badge badge-subtle-primary">ML /
                                    AI</span>
                                </p>
                                <p class="fs-10">Jupyter, RAPIDS, TensorFlow,
                                  PyTorch, Keras, fastai, CUDA, 53GB
                                  size<br /><em>Requires 60GB+ disk</em></p>
                                <small>Included</small>
                              </div>
                            </a>
                          </div>
                          <div class="w-100"></div>
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSUbuntu20.04LTS"
                              href="javascript:chooseOS('Ubuntu 20.04 LTS')">
                              <div class="card-body">
                                <p>Ubuntu 20.04 LTS <i
                                    class="fab fa-ubuntu"></i></p>
                                <p class="fs-10">NVIDIA drivers preinstalled,
                                  5GB size<br /><em>Requires 20GB+ disk</em></p>
                                <small>Included</small>
                              </div>
                            </a>
                          </div>
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSUbuntu22.04LTS"
                              href="javascript:chooseOS('Ubuntu 22.04 LTS')">
                              <div class="card-body">
                                <p>Ubuntu 22.04 LTS <i
                                    class="fab fa-ubuntu"></i></p>
                                <p class="fs-10">NVIDIA drivers preinstalled,
                                  5GB size<br /><em>Requires 20GB+ disk</em></p>
                                <small>Included</small>
                              </div>
                            </a>
                          </div>
                          <div class="col d-flex">
                            <a
                              class="card shadow bg-light text-dark w-100 os-select mb-3"
                              id="chooseOSWindows10"
                              href="javascript:chooseOS('Windows 10')">
                              <div class="card-body">
                                <p>Windows 10 <i
                                    class="fab fa-windows"></i></p>
                                <p class="fs-10">NVIDIA drivers preinstalled,
                                  30GB size<br /><em>Requires 90GB+
                                    disk</em></p>
                                <small>Bring Your Own License</small>
                              </div>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card card-border border-success shadow mb-3">
                  <div class="card-header">
                    <!-- Heading -->
                    <h4 class="mb-0">8. Configure details</h4>
                  </div>
                  <div class="card-body">
                    <div class="list-group list-group-flush">
                      <div class="list-group-item">
                        <div class="form-group">
                          <label for="admin_user">Administrator username</label>
                          <input class="form-control" type="text"
                            id="submitAdminUser" name="admin_user" required
                            value="user" disabled />
                        </div>
                        <div class="form-group">
                          <label for="admin_pass">Administrator password</label>
                          <p class="small">
                            At least 8 characters long and contains at least 1
                            uppercase letter, symbol, or number.
                          </p>
                          <div class="modal fade" id="sshPublicKeyModal"
                            tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog" role="document">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h3 class="modal-title"
                                    id="exampleModalLabel">Update SSH Public
                                    Key</h3>
                                </div>
                                <div class="modal-body">
                                  <p>Set an SSH public key. You will no longer
                                    need to set a password when deploying a
                                    server.</p>
                                  <input class="form-control" id="sshKeys"
                                    name="sshKeys"
                                    placeholder="SSH public key" />
                                </div>
                                <div class="modal-footer">
                                  <button type="button"
                                    class="btn btn-secondary"
                                    data-dismiss="modal">Cancel</button>
                                  <button type="button" class="btn btn-primary"
                                    onclick="updateSSHKeys()">Update</button>
                                </div>
                              </div>
                            </div>
                          </div>
                          <input
                            class="form-control"
                            type="password"
                            id="submitAdminPass"
                            name="admin_pass"
                            required
                            placeholder="Remember to change your password when you log into your machine!" />
                        </div>
                        <div class="form-group">
                          <label for="admin_pass">Name</label>
                          <input class="form-control" type="text"
                            id="submitHostname" name="hostname" required
                            placeholder="e.g. My GPUFleet Server" />
                        </div>
                        <hr />
                        <div class="form-group" id="configure-ports">
                          <p>Configure port forwards</p>
                          <p>
                            <small>You may forward up to <span
                                id="ports-max">0</span> ports. The external port
                              is where requests will enter; the internal port is
                              where you
                              set the requests to be forwarded to. Please
                              remember to include an SSH port (<u>a port
                                forwarded to port 22</u>) or an RDP port (<u>a
                                port forwarded to port 3389</u>) so that you
                              will be able to access your instance once created.
                            </small>
                          </p>
                          <div class="row">
                            <div class="col-6">
                              <p>External port</p>
                            </div>
                            <div class="col-6">
                              <p>Internal port</p>
                            </div>
                          </div>
                          <div id="ports" class="checkbox"></div>
                          <div class="row mt-2">
                            <div class="input-group btn-group w-100">
                              <div class="input-group-prepend">
                                <span
                                  class="p-2 d-flex align-items-center justify-content-center input-group-text h-100 search-select btn btn-primary-soft">
                                  <i class="fas fa-plus fa-xs"
                                    aria-hidden="true"></i>
                                </span>
                              </div>
                              <select
                                class="search-select form-select py-0"
                                id="port-selector"
                                data-live-search="true"
                                data-size="5"
                                data-width="100%"
                                title="Add a new port..."></select>
                            </div>
                            <div class="col-6"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <a data-toggle="collapse" href="#advancedOptionsCollapse"
                      role="button" aria-expanded="false"
                      aria-controls="advancedOptionsCollapse">
                      Click for more advanced options
                    </a>
                    <div class="collapse" id="advancedOptionsCollapse">
                      <br />
                      <div class="form-group">
                        <label for="cloudinit">Cloudinit Script</label>
                        <textarea
                          class="form-control"
                          id="submitCloudinit"
                          name="cloudinit"
                          value
                          placeholder="write_files:&#10;  - path: /home/user/cloudinit_website/index.html&#10;    permissions: '0777'&#10;    content: |&#10;      Woohoo! This site is working!&#10;    owner: user:user &#10;runcmd:&#10;  - docker run -d --restart unless-stopped --stop-timeout 300 -v /home/user/cloudinit_website:/usr/share/nginx/html:ro -p 80:80 --name default_container nginx"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card card-border border-success shadow mb-3">
                  <div class="card-header">
                    <h4 class="mb-0">9. Payment options</h4>
                  </div>
                  <div class="card-body">
                    <div class="list-group list-group-flush">
                      <div class="list-group-item">
                        <p class="fs-10">Choose between on-demand and
                          subscription billing.</p>
                        <div class="form-group">
                          <label for="paymentType">Payment type</label>
                          <select class="form-control form-control-sm"
                            data-style="btn btn-link" id="paymentType">
                            <option value="ondem">On-demand (default)</option>
                            <option value="subscription">Subscription</option>
                          </select>
                        </div>
                        <div class="form-group d-none"
                          id="billingPeriodWrapper">
                          <label for="billingPeriod">Billing period</label>
                          <select class="form-control form-control-sm"
                            data-style="btn btn-link" id="billingPeriod">
                            <option value="1">1 month</option>
                            <option value="3">3 months</option>
                            <option value="6">6 months</option>
                            <option value="12">1 year</option>
                            <option value="36">3 years</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-auto pr-4 pb-5">
                <div class="sticky-top">
                  <div class="card shadow p-3 text-dark" id="cart">
                    <h4>Your Server</h4>
                    <p id="price-summary-text" class="fs-10">
                      Pricing details will appear once you select a <br />
                      location.
                    </p>
                    <div id="price-summary" class="d-none">
                      <p class="fs-10">
                        Your actual charge will be pro-rated to the <br />
                        millisecond.
                      </p>
                      <div class="row">
                        <div class="col-7">
                          <p class="fs-9">
                            <b>
                              <span id="summaryGPUCount"></span>x
                              <span id="summaryGPUModel"></span>
                            </b>
                          </p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryGPUTotalPrice"></span>/hr</p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-7">
                          <p class="h6">
                            <span id="summaryRAM"></span> GB RAM
                          </p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryRAMPrice"></span>/hr</p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-7">
                          <p class="h6">
                            <span id="summaryvCPU"></span> vCPUs
                          </p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryvCPUPrice"></span>/hr</p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-7">
                          <p class="h6">
                            <span id="summaryStorageSpace"></span> GB
                            <span id="summaryStorageClass">NVMe SSD</span>
                          </p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryStoragePrice"></span>/hr</p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <p class="h6">
                            <span id="summaryOS"></span>
                          </p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <p class="h6">
                            <span id="summaryLocation"></span>
                          </p>
                        </div>
                      </div>
                      <hr />
                      <div class="row">
                        <div class="col-7">
                          <p class="h6">Running Cost</p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryTotalPrice"></span>/hr</p>
                        </div>
                      </div>
                      <p class="fs-10">Cost per hour when the VM is
                        running.</p>
                      <div class="row">
                        <div class="col-7">
                          <p class="h6">Stopped Cost</p>
                        </div>
                        <div class="col-5">
                          <p class="h6">$<span
                              id="summaryOffPrice"></span>/hr</p>
                        </div>
                      </div>
                      <p class="fs-10">Cost per hour when the VM is
                        stopped.</p>
                    </div>

                    <hr />
                  <div id="authContent">
                      <div id="deployBtnParent" class="w-100">
                          <a class="btn btn-falcon-primary lift btn-lg w-100 p-3 fs-10"
                             href="/login.html">Login to Deploy Server</a>
                      </div>
                  </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <script>
  // State variables
  let selectedGPU = "";
  let selectedGPUCount = 1;
  let selectedRAMAmount = 4;
  let selectedVCPUAmount = 2;
  let selectedStorageSpaceAmount = 20;
  let selectedLocation = "";
  let selectedOS = "TensorML 20.04 LTS TensorFlow";
  let selectedHostnode = {};
  let selectedBid = 0;

  let displayedLocations = {};
  let displayedLocationsSuggestions = {};

  let totalPriceGPU = 0;
  let totalPriceRAM = 0;
  let totalPriceVCPU = 0;
  let totalPriceStorage = 0;
  let totalPriceOS = 0;

  // Queue for server queries
  class QueryQueue {
    constructor() {
      this.queue = [];
      this.runningJob = null;
    }

    async addJob(job) {
      this.queue.push(job);

      await this.processQueue();
    }

    async processQueue() {
      if (!this.runningJob && this.queue.length) {
        this.runningJob = this.queue[0];
        this.queue.shift();

        await this.runningJob();
        this.runningJob = null;

        await this.processQueue();
      }
    }
  }

  // Constants
  const gpuMappings = {
    "A100 80GB PCIE": "a100-pcie-80gb",
    "A100 40GB PCIE": "a100-pcie-40gb",
    "A100 40GB NVLink": "a100-nvlink-40gb",
    "L40 48GB PCIE": "l40-pcie-48gb",
    "V100 16GB PCIE": "v100-pcie-16gb",
    "V100 16GB NVLink": "v100-nvlink-16gb",
    "RTX A6000 48GB": "rtxa6000-pcie-48gb",
    "RTX A5000 24GB": "rtxa5000-pcie-24gb",
    "RTX A4000 16GB": "rtxa4000-pcie-16gb",
    "GeForce RTX 4090 24GB": "geforcertx4090-pcie-24gb",
    "GeForce RTX 3090 24GB": "geforcertx3090-pcie-24gb",
    "GeForce RTX 3080 Ti 12GB": "geforcertx3080ti-pcie-12gb",
    "GeForce RTX 3080 10GB": "geforcertx3080-pcie-10gb",
    "GeForce RTX 3070 Ti 8GB": "geforcertx3070ti-pcie-8gb",
    "GeForce RTX 3060 12GB": "geforcertx3060-pcie-12gb",
    "GeForce RTX 3060 Ti 8GB": "geforcertx3060ti-pcie-8gb",
    "GeForce GTX 1070 8GB": "geforcegtx1070-pcie-8gb",
    "Quadro RTX 4000 8GB": "quadrortx4000-pcie-8gb",
    "Quadro RTX 5000 16GB": "quadrortx5000-pcie-16gb",
  };

  const osMappings = {
    "Ubuntu 20.04 LTS": "Ubuntu 20.04 LTS",
    "Ubuntu 22.04 LTS": "Ubuntu 22.04 LTS",
    "TensorML 20.04 LTS TensorFlow": "TensorML 20 TensorFlow",
    "TensorML 20.04 LTS PyTorch": "TensorML 20 PyTorch",
    "TensorML 20.04 LTS Everything": "TensorML 20 Everything",
    "TensorML 20.04 LTS RAPIDS": "TensorML 20 RAPIDS",
    "Windows 10": "Windows 10",
  };

  // Constants
  const networkServersPriceGPU = {
    "A100 80GB PCIE": 2.43,
    "A100 40GB NVLink": 2.27,
    "A100 40GB PCIE": 2.27,
    "V100 16GB NVLink": 0.88,
    "V100 16GB PCIE": 0.52,
    "RTX A6000 48GB": 1.41,
    "RTX A5000 24GB": 0.85,
    "RTX A4000 16GB": 0.68,
    "Quadro RTX 4000 8GB": 0.27,
    "Quadro RTX 5000 16GB": 0.63,
  };
  const networkServersPriceCPU = 0.01;
  const networkServersPriceRAM = 0.005;
  const networkServersPriceStorage = 0.0001;

  // Utility functions
  function formatGPU(gpu) {
    return gpu
      .replaceAll("-", " ")
      .replace("pcie", "PCIE")
      .replace("geforce", "GeForce")
      .replace("gtx", " GTX ")
      .replace("rtx", " RTX ")
      .replace("ti", " Ti")
      .replace("gb", " GB")
      .replace("a", "A")
      .replace("l", "L")
      .replace("v", "V")
      .replace("sxm2", "SXM2");
  }

  function roundValue(value) {
    return Math.round(value * 1000) / 1000;
  }

  function formatLineItem(value) {
    return roundValue(value).toFixed(4);
  }

  function checkPassword(password) {
    // Password has to be at least 8 characters with at least 1 uppercase letter, symbol, or number.
    return (
      password.length >= 8 &&
      (/[A-Z]/.test(password) || /[\W_]/.test(password) || /\d/.test(password))
    );
  }

  // DOM functions
  function toggleButtonStyles(buttonClassNames, selectedButtonId) {
    const buttons = document.getElementsByClassName(buttonClassNames);

    // Clear styles for all buttons
    for (let i = 0; i < buttons.length; i++) {
      buttons[i].classList.replace("bg-dark", "bg-light");
      buttons[i].classList.replace("text-light", "text-dark");
    }

    // Darken selected button
    const element = document.getElementById(selectedButtonId);
    element.classList.replace("bg-light", "bg-dark");
    element.classList.replace("text-dark", "text-light");

    document.getElementById(selectedButtonId).blur();
  }

  function createLocationCard(locations, locationId, parentElementId) {
    const locationInfo = locations[locationId];
    const locationCard = document.createElement("div");

    const reservedHostnode = locationInfo.hostnodes.find(
      (hostnode) => hostnode.reserved
    );
    const defaultHostnode = reservedHostnode || locationInfo.hostnodes[0];
    const uptime = (defaultHostnode.uptime * 100).toFixed(2);
    const lowUptime = uptime < 99.5;
    const { cpu, gpu, ram, storage } = defaultHostnode.specs;

    const reservedBadge = `<span class="mb-2 badge bg-warning text-dark">Reserved for you</span>`;
    const lowUptimeBadge = `<span class="mb-2 badge bg-warning" style="margin-right: 0.4em">Low Uptime</span>`;

    locationCard.innerHTML =
      `<a class="card shadow bg-light text-dark w-100 location-select mb-3" id="chooseLocation${locationId}" href="javascript:chooseLocation('${locationId}')"><div class="card-body">` +
      "<p>" +
      locationInfo.location +
      " - $" +
      locationInfo.price +
      "/hr " +
      "</p>" +
      (lowUptime ? lowUptimeBadge : "") +
      '<span class="mb-2 badge badge-subtle-secondary" style="margin-right: 0.4em">Local-based storage</span>' +
      '<span class="mb-2 badge badge-subtle-primary" style="margin-right: 0.4em">' +
      locationInfo.availability +
      "</span>" +
      (reservedHostnode ? reservedBadge : "") +
      "<p class='fs-10'>" +
      gpu[locationInfo.gpuType].amount +
      "x " +
      formatGPU(locationInfo.gpuType) +
      ", " +
      cpu.amount +
      "x " +
      locationInfo.cpuType +
      " vCPUs, " +
      ram.amount +
      " GB RAM, " +
      storage.amount +
      " GB NVMe SSD, " +
      `${uptime}% Uptime` +
      "</p></div></a>";
    

    document.getElementById(parentElementId).appendChild(locationCard);
  }

  function formatLocationAvailability(stock) {
    if (stock >= 8) return "High Stock";
    if (stock >= 4 && stock < 8) return "Medium Stock";
    return "Low Stock";
  }

  function handleBid() {
    if (!selectedHostnode) return showError("Please select a location.");

    // Toggle button if bid already selected
    if (selectedBid) {
      selectedBid = 0;

      document
        .getElementById("bidapply-button")
        .classList.replace("btn-secondary-soft", "btn-primary-soft");
      document.getElementById("bidapply-button").innerHTML = "Apply Bid";

      return;
    }

    const bidPrice = Number(document.getElementById("bid-input").value);

    const apiRoute = "/api/session/vm/new_bid_validate";

    const body = JSON.stringify({
      compute_price: bidPrice,
      ram: selectedRAMAmount,
      vcpus: selectedVCPUAmount,
      storage: selectedStorageSpaceAmount,
      gpu_model: gpuMappings[selectedGPU],
      gpu_count: selectedGPUCount,
      hostnode: selectedHostnode.id,
    });

    fetch(apiRoute, {
      method: "POST",
      body,
      headers: {
        Accept: "application/json",
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((result) => {
        if (result.success) {
          selectedBid = bidPrice;

          showSuccess(
            "This bid is high enough that if you were to deploy a spot instance with this, then it would succeed."
          );

          document
            .getElementById("bidapply-button")
            .classList.replace("btn-primary-soft", "btn-secondary-soft");
          document.getElementById("bidapply-button").innerHTML = "Remove Bid";
        } else if (result.min_bid) {
          showError(
            "This bid is not high enough because the host's minimum bid rules are not fulfilled. The minimum compute bid for your requested hardware configuration is " +
            result.min_bid +
            "."
          );
        } else {
          showError(
            "This bid is not high enough. You need a higher bid to outbid your competitors for your server to be created."
          );
        }
      })
      .catch((error) => console.error("Error:", error));
  }

  function removePort(port) {
    // Remove port configuration
    document.getElementById(`port-${port}-row`).remove();

    // Make port option selectable
    document
      .getElementById(`port-selector-${port}`)
      .removeAttribute("disabled");
  }

  function addPort(port, defaultOutput = "") {
    // Disable port selection
    document.getElementById(`port-selector-${port}`).disabled = true;

    // Add port to list
    const portConfiguration = document.createElement("div");

    portConfiguration.innerHTML = `
      <div class="row mt-2 port-checkbox" id="port-${port}-row" data-port="${port}">
        <div class="col-6">
          <div class="btn-group">
            <button
              type="button"
              id="port-${port}"
              aria-label="Close"
              class="btn btn-danger-soft px-2 py-0 port-close"
              value="${port}"
              onclick="removePort(${port})"
            >
              <i class="fas fa-times fa-xs" aria-hidden="true"></i>
            </button>
            <button class="btn py-0" type="button" disabled>
              ${port}
            </button></button>
          </div>
        </div>
        <div class="col-6">
          <input
            type="number"
            class="col-6 form-control port-forward py-0"
            max="65535"
            min="1"
            id="outputport-${port}"
            value="${defaultOutput}"
          />
        </div>
      </div>`;

    document.getElementById("ports").appendChild(portConfiguration);
  }

  function calculateTotalPrice(specs) {
    const { gpuTotal, ramTotal, cpuTotal, storageTotal, total } =
      calculateVMPrice(specs);

    totalPriceGPU = formatLineItem(gpuTotal);
    totalPriceRAM = formatLineItem(ramTotal);
    totalPriceVCPU = formatLineItem(cpuTotal);
    totalPriceStorage = formatLineItem(storageTotal);

    const totalPrice = formatLineItem(total);

    // Set subtotals
    document.getElementById("summaryGPUTotalPrice").innerHTML = totalPriceGPU;
    document.getElementById("summaryRAMPrice").innerHTML = totalPriceRAM;
    document.getElementById("summaryvCPUPrice").innerHTML = totalPriceVCPU;
    document.getElementById("summaryStoragePrice").innerHTML =
      totalPriceStorage;

    document.getElementById("summaryTotalPrice").innerHTML = totalPrice;
    document.getElementById("summaryOffPrice").innerHTML = totalPriceStorage;
  }

  const showMessage = (message, isError = true) => {
        const messageBox = document.getElementById('messageBox');
        messageBox.style.display = 'block';
        messageBox.textContent = message;
        messageBox.className = isError ? 'alert alert-danger' : 'alert alert-success';
    };

  async function chooseGPU(gpu) {
    selectedGPU = gpu;

    document.getElementById("summaryGPUModel").innerHTML = selectedGPU;
    document.getElementById("locationSelectHeader").innerHTML = selectedGPU;

    toggleButtonStyles(
      "gpu-select",
      "chooseGPU" + selectedGPU.replaceAll(" ", "")
    );

    await updateAvailableLocations();
  }

  function customizeServer(value, fieldId) {
    document.getElementById(fieldId).innerHTML = value.toString();

    updateAvailableLocations();
  }

  function chooseOS(os) {
    selectedOS = os;

    document.getElementById("summaryOS").innerHTML = selectedOS.includes(
      "TensorML 20.04 LTS"
    )
      ? "TensorML 20.04 LTS"
      : selectedOS;

    toggleButtonStyles("os-select", "chooseOS" + os.replaceAll(" ", ""));
  }

  function calculateVMPrice(specs) {
    const { gpuPrice, ramPrice, cpuPrice, storagePrice } = specs;

    const resourcePrices = {
      gpuTotal: gpuPrice * selectedGPUCount,
      ramTotal: ramPrice * selectedRAMAmount,
      cpuTotal: cpuPrice * selectedVCPUAmount,
      storageTotal: storagePrice * selectedStorageSpaceAmount,
    };

    // TODO: Increase granularity of rounding for merging purposes
    const total = Object.values(resourcePrices)
      .reduce((acc, curr) => acc + roundValue(curr), 0)
      .toFixed(4);

    return {
      gpuTotal: resourcePrices.gpuTotal,
      ramTotal: resourcePrices.ramTotal,
      cpuTotal: resourcePrices.cpuTotal,
      storageTotal: resourcePrices.storageTotal,
      total,
    };
  }

  function sortLocations(locations) {
    return Object.fromEntries(
      Object.entries(locations).sort((a, b) => {
        const [, locationA] = a;
        const [, locationB] = b;

        return (
          !!locationB.hostnodes?.find((node) => node.reserved) -
          !!locationA.hostnodes?.find((node) => node.reserved) ||
          locationA.price - locationB.price
        );
      })
    );
  }

  const queryQueue = new QueryQueue();

  async function updateAvailableLocations() {
    async function queryJob() {
      // Clear location and hostnode
      selectedLocation = "";
      selectedHostnode = {};

      // Clear location matches and location suggestions
      displayedLocations = {};
      displayedLocationsSuggestions = {};

      document.getElementById("hostnodeOptionsRow").innerHTML = "";
      document.getElementById("hostnodeOptionsRowSuggestions").innerHTML = "";

      // Hide price summary
      document.getElementById("price-summary-text").classList.remove("d-none");
      document.getElementById("price-summary").classList.add("d-none");

      // Add loading spinners
      document.getElementById("hostnodeOptionsRowLoading").innerHTML = `
        <div class="spinner-border text-secondary" role="status">
          <!-- <span class="sr-only">Loading...</span> -->
        </div>
    `;

      document.getElementById(
        "hostnodeOptionsRowSuggestionsLoading"
      ).innerHTML = `
        <div class="spinner-border text-secondary" role="status">
          <!-- <span class="sr-only">Loading...</span> -->
        </div>
    `;

      // Fetch local hostnodes
      const localServersApiRoute = "https://marketplace.tensordock.com/api/v0/client/deploy/hostnodes"

      const localServersRequestParams = new URLSearchParams({
        minGPUCount: selectedGPUCount,
        minRAM: selectedRAMAmount,
        minvCPUs: selectedVCPUAmount,
        minStorage: selectedStorageSpaceAmount,
        minVRAM: Number(selectedGPU.match(/(\d+)\s*GB/)[1]),
        requiresRTX: selectedGPU.includes("RTX"),
        subdomain: window.location.host.split('.')[0],
      });

      const request = await fetch(`${localServersApiRoute}?${localServersRequestParams}`);

      const { hostnodes } = await request.json();

      for (const hostnode in hostnodes) {
        const hostnodeProperties = hostnodes[hostnode];

        for (const hostnodeGPU in hostnodeProperties.specs.gpu) {
          const vmPrice = calculateVMPrice({
            gpuPrice: hostnodeProperties.specs.gpu[hostnodeGPU].price,
            ramPrice: hostnodeProperties.specs.ram.price,
            cpuPrice: hostnodeProperties.specs.cpu.price,
            storagePrice: hostnodeProperties.specs.storage.price,
          }).total;

          const listToUpdate =
            gpuMappings[selectedGPU] === hostnodeGPU
              ? displayedLocations
              : displayedLocationsSuggestions;

          const currentLocationId =
            hostnodeProperties.location.id + vmPrice.toString();

          // Validate each GPU individually, as the returned hostnodes may have GPUs not matching the criteria
          if (
            hostnodeProperties.specs.gpu[hostnodeGPU].amount <
            selectedGPUCount ||
            hostnodeProperties.specs.gpu[hostnodeGPU].vram <
            Number(
              selectedGPU
                .split(" ")
                [selectedGPU.split(" ").length - 1].replace("GB", "")
            ) ||
            (selectedGPU.includes("RTX") &&
              !hostnodeProperties.specs.gpu[hostnodeGPU].rtx)
          )
            continue;

          if (listToUpdate[currentLocationId]) {
            // If there are two or more hostnodes, we automatically say there is medium availability, even if there is only 1 GPU on each
            // If there are more than 8 GPUs, we say there is high availability... 8 unrented GPUs in one location is a lot!
            listToUpdate[currentLocationId].stock +=
              hostnodeProperties.specs.gpu[hostnodeGPU].amount;
            listToUpdate[currentLocationId].availability =
              formatLocationAvailability(listToUpdate[currentLocationId].stock);

            if (
              !listToUpdate[currentLocationId].hostnodes.find(
                (node) => node.id === hostnode
              )
            ) {
              listToUpdate[currentLocationId].hostnodes.push({
                id: hostnode,
                ports: hostnodeProperties.networking.ports,
                specs: hostnodeProperties.specs,
                reserved: hostnodeProperties.status.reserved,
                uptime: hostnodeProperties.status.uptime,
              });
            }
          } else {
            listToUpdate[currentLocationId] = {
              type: "local",
              availability: formatLocationAvailability(
                hostnodeProperties.specs.gpu[hostnodeGPU].amount
              ),
              location:
                hostnodeProperties.location.city +
                ", " +
                hostnodeProperties.location.region +
                ", " +
                hostnodeProperties.location.country,
              price: vmPrice,
              gpuType: hostnodeGPU,
              stock: hostnodeProperties.specs.gpu[hostnodeGPU].amount,
              cpuType: hostnodeProperties.specs.cpu.type,
              hostnodes: [
                {
                  id: hostnode,
                  ports: hostnodeProperties.networking.ports,
                  specs: hostnodeProperties.specs,
                  reserved: hostnodeProperties.status.reserved,
                  uptime: hostnodeProperties.status.uptime,
                },
              ],
            };
          }
        }
      }

      document.getElementById(
        "hostnodeOptionsRowSuggestionsLoading"
      ).innerHTML = "";

      for (const location in sortLocations(displayedLocations)) {
        createLocationCard(displayedLocations, location, "hostnodeOptionsRow");
      }

      for (const locationSuggestion in sortLocations(
        displayedLocationsSuggestions
      )) {
        createLocationCard(
          displayedLocationsSuggestions,
          locationSuggestion,
          "hostnodeOptionsRowSuggestions"
        );
      }

      document.getElementById("hostnodeOptionsRowSuggestions").style.height =
        "280px";
      document.getElementById("hostnodeOptionsRowLoading").innerHTML = "";
    }

    await queryQueue.addJob(queryJob);
  }

  function updatePorts(hostnode) {
    // Clear ports
    document.getElementById("ports").innerHTML = "";
    document.getElementById("port-selector").innerHTML = "";

    // Set maximum ports
    const { ports } = hostnode;
    document.getElementById("ports-max").innerHTML = ports.length;

    ports.forEach((port, index) => {
      // Add port selection options
      const portOption = document.createElement("option");

      portOption.setAttribute("id", `port-selector-${port}`);
      portOption.setAttribute("value", port);
      portOption.innerHTML = port;

      // Add port configuration elements
      document.getElementById("port-selector").appendChild(portOption);

      const defaultOutputPort = [22, 3389, 8888][index];

      if (index < 3) addPort(port, defaultOutputPort);
    });
  }

  async function chooseLocation(location) {
    const locationInfo = {
      ...displayedLocations,
      ...displayedLocationsSuggestions,
    }[location];

    // Only update GPU if it is not an exact match, only applies to local products
    if (displayedLocationsSuggestions[location]) {
      const formattedGPU = Object.keys(gpuMappings).find(
        (gpuName) => gpuMappings[gpuName] === locationInfo.gpuType
      );

      await chooseGPU(formattedGPU);
    }

    selectedLocation = locationInfo;

    if (locationInfo.type === "local") {
      // Set hostnode
      const reservedHostnode = locationInfo.hostnodes.find(
        (hostnode) => hostnode.reserved
      );
      selectedHostnode = reservedHostnode || selectedLocation.hostnodes[0];

      updatePorts(selectedHostnode);

      calculateTotalPrice({
        gpuPrice: selectedHostnode.specs.gpu[selectedLocation.gpuType].price,
        ramPrice: selectedHostnode.specs.ram.price,
        cpuPrice: selectedHostnode.specs.cpu.price,
        storagePrice: selectedHostnode.specs.storage.price,
      });
    }

    if (locationInfo.type === "network") {
      calculateTotalPrice({
        gpuPrice: networkServersPriceGPU[selectedGPU],
        ramPrice: networkServersPriceRAM,
        cpuPrice: networkServersPriceCPU,
        storagePrice: networkServersPriceStorage,
      });
    }

    // Toggle visibility of ports/bidding depending on network/local
    const configurePortsElement = document.getElementById("configure-ports");

    if (locationInfo.type === "network") {
      configurePortsElement.classList.add("d-none");
    } else {
      configurePortsElement.classList.remove("d-none");
    }

    // Toggle visibility of price summary
    document.getElementById("price-summary-text").classList.add("d-none");
    document.getElementById("price-summary").classList.remove("d-none");

    document.getElementById("summaryLocation").innerHTML = locationInfo.location;
    toggleButtonStyles("location-select", "chooseLocation" + location);
  }

  async function deployServer(redirected, split_url) {
    let sendAdminUser;
    let sendAdminPass;
    let sendHostname;
    let sendCloudinit;
    let externalPorts = [];
    let internalPorts = [];

    document.getElementById("deployBtnParent").innerHTML = `
    <button class="btn btn-falcon-primary w-100 lift btn-lg d-flex align-items-center justify-content-center" type="button" disabled>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="margin-right: 7px"></span>
        <span>Deploying...</span>
    </button>
    `;

    Array.from(document.getElementsByClassName("port-checkbox")).forEach((element) => {
      const externalPort = parseInt(element.getAttribute("data-port"));

      externalPorts.push(externalPort);

      const internalPort = parseInt(
        document.getElementById(`outputport-${externalPort}`).value
      );
      internalPorts.push(internalPort);
    });

    sendAdminUser = document.getElementById("submitAdminUser").value;
    sendAdminPass = document.getElementById("submitAdminPass").value;
    sendHostname = document.getElementById("submitHostname").value;
    sendCloudinit = document.getElementById("submitCloudinit").value;

    // Validation
    if (!selectedGPU) {
        showMessage("Please select a graphics card to provision.", true);
        return;
      }

      if (!selectedLocation) {
        showMessage("Please select a location.", true);
        return;
      }

      if (parseInt("{{account_amount_deployed}}") + selectedGPUCount > parseInt("{{account_amount_limit}}") && "{{logged_in}}" == "True") {
        alert("Please contact us at support@tensordock.com to increase your account's GPU limit, which is currently {{account_amount_limit}}.");
        return;
      }

      if (!sendAdminUser) {
        alert("Please define the administrator username.");
        return;
      }

      if (sendAdminPass && !checkPassword(sendAdminPass)) {
        alert("Make sure the administrator password is at least 8 characters long and contains at least 1 uppercase letter, symbol, or number.");
        return;
      }

      if (selectedLocation.type === "local" && (!externalPorts.length || !internalPorts.filter((port) => port).length)) {
        alert("Please configure external and internal ports.");
        return;
      }

      if (!sendHostname) {
        alert("Please define the server's hostname.");
        return;
      }

      if (selectedOS === "Windows 10" && selectedStorageSpaceAmount < 90) {
        alert("Please ensure you have enough storage space (90 GB) for our Windows 10 operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS RAPIDS" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS RAPIDS operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS TensorFlow" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS TensorFlow operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS PyTorch" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS PyTorch operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS Everything" && selectedStorageSpaceAmount < 60) {
        alert("Please ensure you have enough storage space (60 GB) for our TensorML 20.04 LTS Everything operating system template.");
        return;
      }

    const apiRoute = "https://marketplace.tensordock.com/api/v0/client/deploy/single";

    const body = {
      deployment_type: selectedLocation.type,
      ...(sendAdminPass && { password: sendAdminPass }),
      name: sendHostname,
      vcpus: selectedVCPUAmount,
      storage: selectedStorageSpaceAmount,
      ram: selectedRAMAmount,
      country: "United States",
      gpu_count: selectedGPUCount,
      gpu_model: gpuMappings[selectedGPU],
      operating_system: osMappings[selectedOS],
      ...(selectedLocation.type === "local" && {
        hostnode: selectedHostnode.id,
        external_ports: `[${externalPorts.join(', ')}]`,
        internal_ports: `[${internalPorts.join(', ')}]`,
      }),
      ...(selectedLocation.type === "network" && {
        location: selectedLocation.location,
      }),
      ...(sendCloudinit && {
        cloudinit_script: sendCloudinit,
      }),
      ...(selectedBid && {
        price_type: "spot",
        price: selectedBid,
      }),
    };

    const formData = new FormData();

    Object.keys(body).forEach((key) => {
      const value = body[key];
      formData.append(key, value);
    });

    const whitelabelToken = document.cookie.split('; ').find(row => row.startsWith('whitelabelToken='));

    const request = await fetch(apiRoute, {
      method: "POST",
      body: formData,
      credentials: "include",
      headers: {
        'Authorization': whitelabelToken.split('=')[1],
      },
    });

    const response = await request.json();

    if (response.success) {
      window.location.href = '/list';
      showMessage("Successfully deployed!", false);
    } else {
      showMessage(
        `${response.error} There was an error deploying your server.`, true
      );

      document.getElementById("deployBtnParent").innerHTML =
        '<a class="btn btn-falcon-primary w-100 lift btn-lg" href="javascript:deployServer(true, null)">Deploy Server</a>';
    }
  }

  async function updateSSHKeys() {
    const sshKeys = document.getElementById("sshKeys").value;
    const apiRoute = "/ssh_public_keys";
    const body = { ssh_keys: sshKeys };

    const request = await fetch(apiRoute, {
      method: "POST",
      body: JSON.stringify(body),
      headers: {
        Accept: "application/json",
        "Content-Type": "application/json",
      },
    });

    const response = await request.json();

    if (response.status === 'success') showSuccess("Updated SSH public keys successfully.");
    else showError("Failed to update SSH public keys. Try logging in again.");
  }

  $("#selectGPUCount").on("change", (e) => {
    selectedGPUCount = e.target.value;
    return customizeServer(selectedGPUCount, "summaryGPUCount");
  });

  $("#selectRAM").on("change", (e) => {
    selectedRAMAmount = e.target.value;
    return customizeServer(selectedRAMAmount, "summaryRAM");
  });

  $("#selectvCPU").on("change", (e) => {
    selectedVCPUAmount = e.target.value;
    return customizeServer(selectedVCPUAmount, "summaryvCPU");
  });

  $("#selectStorageSpace").on("change", (e) => {
    selectedStorageSpaceAmount = e.target.value;
    return customizeServer(selectedStorageSpaceAmount, "summaryStorageSpace");
  });

  $("#port-selector").on("change", (e) => addPort(e.target.value));

  document.getElementById("summaryGPUCount").innerHTML =
    selectedGPUCount.toString();
  document.getElementById("summaryRAM").innerHTML =
    selectedRAMAmount.toString();
  document.getElementById("summaryvCPU").innerHTML =
    selectedVCPUAmount.toString();
  document.getElementById("summaryStorageSpace").innerHTML =
    selectedStorageSpaceAmount.toString();

  document.getElementById("summaryOS").innerHTML = selectedOS.includes(
    "TensorML 20.04 LTS"
  )
    ? "TensorML 20.04 LTS"
    : selectedOS;
  toggleButtonStyles("os-select", "chooseOS" + selectedOS.replaceAll(" ", ""));

  const baseUrl = 'https://marketplace.tensordock.com';
  const checkLoggedIn = async () => {
    let loggedIn = false;
    
    const whitelabelToken = document.cookie.split('; ').find(row => row.startsWith('whitelabelToken=')).split('=')[1];

    if (whitelabelToken) {
      try {
        const response = await fetch(`${baseUrl}/api/v0/client/whitelabel/token_verify`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': whitelabelToken,
          }
        });

        if (response.ok) {
          const tokenVerifyResponse = await response.json();
          loggedIn = true;
        }
      } catch (error) {
        console.error("Error verifying token:", error);
      }
    }

    return loggedIn;
}

document.addEventListener('DOMContentLoaded', async () => {
  async function getAccountFunds() {
      const whitelabelToken = document.cookie.split('; ').find(row => row.startsWith('whitelabelToken=')).split('=')[1];

      try {
        const response = await fetch(`${baseUrl}/api/vO/client/whitelabel/getUserInfo`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': whitelabelToken,
          },
        });

        if (response.ok) {
          const userInquiryResponse = await response.json();
          return userInquiryResponse.balance;

        }
      } catch (error) {
        console.error("Error verifying token:", error);
        showMessage("Error retrieving account information", true);
        return "Error getting information";
      }
    };

  const balance = await getAccountFunds();
  const loggedIn = await checkLoggedIn();
  const authContent = document.getElementById('authContent');

  if (!loggedIn) {
    authContent.innerHTML = `
      <div id="redirectBtnParent" class="w-100">
        <a href="/login" class="btn btn-falcon-primary w-100 lift btn-lg">
          Login to Deploy Server
        </a>
      </div>`;
  } else if (balance > 0) {
      authContent.innerHTML = `
      <div id="deployBtnParent" class="w-100">
        <a class="btn btn-falcon-primary w-100 lift btn-lg" href="javascript:deployServer(true, null)">
          Deploy Server
        </a>
      </div>`;
  } else if (balance <= 0){
    authContent.innerHTML = `
      <div id="depositBtnParent" class="w-100">
        <a class="btn btn-falcon-primary w-100 lift btn-lg" href="/account">
          Balance too low, click to deposit
        </a>
      </div>`;
  }
});

  chooseGPU('L40 48GB PCIE');
</script>
      </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>