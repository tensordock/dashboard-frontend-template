<!DOCTYPE html>
<html lang="en">
  <script src="https://js.stripe.com/v3/"></script>
  <meta charset="UTF-8">
  <title>Deploy a Server - H100cloud.com</title>
  <link
    rel="preconnect" href="https://fonts.gstatic.com">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700%7cPoppins:300,400,500,600,700,800,900&amp;display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="static/css/theme.bundle.css" />
  <link rel="stylesheet" href="./static/css/custom.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script>
  //  const stripe = Stripe('pk_live_51JqNQYHSshR0IOtvfpFJ335VCKxHeyzKzGT8XaWMNvt5ye74VXApsofamVwZN3Ec2H9Y9Ap5WsVlVwxgnEL1Ys7R00rbTg3ky9');
  </script>

  <body>
    <main>
      <div class="container" data-layout="container">
        <nav
          class="navbar navbar-light navbar-vertical navbar-expand-xl">
          <script>
                var navbarStyle = localStorage.getItem("navbarStyle");
                if (navbarStyle && navbarStyle !== 'transparent') {
                  document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                }
              </script>
          <div class="d-flex align-items-center">
            <a class="navbar-brand" href="/home">
              <div class="d-flex align-items-center py-3">
                <span class="font-sans-serif text-primary">H100cloud</span>
              </div>
            </a>
          </div>
          <div class="collapse navbar-collapse" id="navbarVerticalCollapse">
            <div class="navbar-vertical-content scrollbar">
              <ul class="navbar-nav flex-column mb-3"
                id="navbarVerticalNav">
                <li class="nav-item">
                  <a class="nav-link" href="/home" role="button">
                    <div
                      class="d-flex align-items-center"><span
                        class="nav-link-icon"><svg
                          class="svg-inline--fa fa-globe fa-w-16"
                          aria-hidden="true" focusable="false" data-prefix="fas"
                          data-icon="globe" role="img"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 496 512" data-fa-i2svg><path
                            fill="currentColor"
                            d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg><!-- <span class="fas fa-globe"></span> Font Awesome fontawesome.com --></span>
                      Home
                    </div>
                  </a>
                  <a class="nav-link" href="/deploy" role="button">
                    <div class="d-flex align-items-center">
                      <span class="nav-link-icon">
                        <svg class="svg-inline--fa fa-rocket fa-w-16"
                          aria-hidden="true" focusable="false" data-prefix="fas"
                          data-icon="rocket" role="img"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 512 512" data-fa-i2svg>
                          <path fill="currentColor"
                            d="M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z">
                          </path>
                        </svg><!-- <span class="fas fa-rocket"></span> Font Awesome fontawesome.com -->
                      </span>Deploy a new H100
                    </div>
                  </a>
                  <a class="nav-link" href="/list" role="button">
                    <div
                      class="d-flex align-items-center"><span
                        class="nav-link-icon"><svg
                          class="svg-inline--fa fa-window-restore fa-w-16"
                          aria-hidden="true" focusable="false" data-prefix="far"
                          data-icon="window-restore" role="img"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 512 512" data-fa-i2svg><path
                            fill="currentColor"
                            d="M464 0H144c-26.5 0-48 21.5-48 48v48H48c-26.5 0-48 21.5-48 48v320c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-96 464H48V256h320v208zm96-96h-48V144c0-26.5-21.5-48-48-48H144V48h320v320z"></path></svg><!-- <span class="far fa-window-restore"></span> Font Awesome fontawesome.com --></span>
                      Virtual machines
                    </div>
                  </a>
                  <a class="nav-link" href="/account" role="button">
                    <div
                      class="d-flex align-items-center"><span
                        class="nav-link-icon"><svg
                          class="svg-inline--fa fa-user fa-w-14"
                          aria-hidden="true" focusable="false" data-prefix="fas"
                          data-icon="user" role="img"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 448 512" data-fa-i2svg><path
                            fill="currentColor"
                            d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg><!-- <span class="fas fa-user"></span> Font Awesome fontawesome.com --></span>
                      Account
                    </div>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>

        <!-- Main Content -->
        <div class="content">
          <nav
            class="navbar navbar-light navbar-glass navbar-expand">
            <a class="navbar-brand me-1 me-sm-3" href="/">
              <div class="d-flex align-items-center">
              </div>
            </a>
            <ul
              class="navbar-nav navbar-nav-icons ms-auto flex-row align-items-center">
              <li class="nav-item dropdown" style="min-height: 40px">
                <a
                  class="nav-link pe-0 ps-2 text-black"
                  id="navbarDropdownUser"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true"><svg
                    class="svg-inline--fa fa-user-circle fa-w-16 text-900 pt-2 fs-6"
                    aria-hidden="true" focusable="false" data-prefix="far"
                    data-icon="user-circle" role="img"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"
                    data-fa-i2svg><path fill="currentColor"
                      d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                  <span>Balance: $<span
                      id="headerAccountBalance">0.00</span></span>
                </a>
                <div
                  class="dropdown-menu dropdown-caret dropdown-menu-end py-0"
                  aria-labelledby="navbarDropdownUser"
                  data-popper="static">
                  <div class="bg-white dark__bg-1000 rounded-2 py-2">
                    <a class="dropdown-item" href="/account">Account</a>
                    <a class="dropdown-item" href="#"
                      onclick="document.cookie='whitelabelToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'; window.location.href='/home'">Logout</a>
                  </div>
                </div>
              </li>
            </ul>
          </nav>
          <div class="card overflow-hidden mb-3">
            <div class="card-body position-relative">
              <h5 class="text-600 py-1 fs-10">For just $2.50/H100/hr</h5>
              <h2 class="my-2">Deploy a cloud H100 SXM5 GPU</h2>
              <p>
                Premium OEM-manufactured servers.
                Tier 3 data centers. NVSwitch fabric
                passed through when you deploy 8 GPUs. &nbsp;
                <a class="btn btn-link border btn-sm"
                  href="https://www.strategicinfra.com" target="_blank">
                  Our Infrastructure
                </a>
              </p>
            </div>
          </div>
          <div>
            <div class="row">
              <div class="col">
                <div
                  class="card card-border border-success shadow mb-3 pt-2 pb-0">
                  <div class="card-header my-0 pb-0">
                    <h4 class="my-0">Select a configuration</h4>
                  </div>
                  <div class="card-body pt-2">
                    <p>
                      Need InfiniBand or custom deployments?&nbsp; <a
                        class="btn btn-link border btn-sm"
                        href="mailto:support@tensordock.com">
                        Email Us.
                      </a>
                    </p>
                    <div
                      style="overflow: scroll; gap: 16px; max-height: 800px;"
                      class="px-1 col" id="configurationSelectBox">
                      <i>Fetching latest inventory data...</i>
                    </div>
                  </div>
                </div>
                <div
                  class="card card-border border-success shadow mb-3 pt-2 pb-0">
                  <div class="card-header my-0 pb-0">
                    <h4 class="my-0">Select an operating system</h4>
                  </div>
                  <div class="card-body pt-2">
                    <p class="mb-3">
                      All templates come with NVIDIA drivers preinstalled.
                    </p>
                    <div class="row">
                      <div class="col d-flex">
                        <a
                          class="card shadow bg-light text-dark w-100 os-select mb-3"
                          id="chooseOSTensorML20.04LTSTensorFlow"
                          href="javascript:chooseOS('TensorML 20.04 LTS TensorFlow')">
                          <div class="card-body">
                            <p>
                              <b>Ubuntu 22 TensorFlow</b>
                              <i class="fab fa-ubuntu"></i>&nbsp;<span
                                class="badge badge-subtle-primary">ML /
                                AI</span>
                            </p>
                            <p class="fs-10">Docker, Jupyter, TensorFlow, Keras,
                              CUDA</p>
                          </div>
                        </a>
                      </div>
                      <div class="col d-flex">
                        <a
                          class="card shadow bg-light text-dark w-100 os-select mb-3"
                          id="chooseOSTensorML20.04LTSPyTorch"
                          href="javascript:chooseOS('TensorML 20.04 LTS PyTorch')">
                          <div class="card-body">
                            <p>
                              <b>Ubuntu 22 PyTorch</b>
                              <i class="fab fa-ubuntu"></i>&nbsp;<span
                                class="badge badge-subtle-primary">ML /
                                AI</span>
                            </p>
                            <p class="fs-10">
                              Docker, Jupyter, PyTorch, CUDA
                            </p>
                          </div>
                        </a>
                      </div>
                      <div class="col d-flex">
                        <a
                          class="card shadow bg-light text-dark w-100 os-select mb-3"
                          id="chooseOSTensorML20.04LTSEverything"
                          href="javascript:chooseOS('TensorML 20.04 LTS Everything')">
                          <div class="card-body">
                            <p>
                              <b>Ubuntu 22 Everything</b>
                              <i class="fab fa-ubuntu"></i>&nbsp;<span
                                class="badge badge-subtle-primary">ML /
                                AI</span>
                            </p>
                            <p class="fs-10">Docker, Jupyter, RAPIDS,
                              TensorFlow,
                              PyTorch, Keras, fastai, CUDA</p>
                          </div>
                        </a>
                      </div>
                      <div class="col d-flex">
                        <a
                          class="card shadow bg-light text-dark w-100 os-select mb-3"
                          id="chooseOSUbuntu22.04LTS"
                          href="javascript:chooseOS('Ubuntu 22.04 LTS')">
                          <div class="card-body">
                            <p><b>Ubuntu 22.04 LTS</b> <i
                                class="fab fa-ubuntu"></i></p>
                            <p class="fs-10">Docker</p>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class="card card-border border-success shadow mb-3 pt-2 pb-0">
                  <div class="card-header my-0 pb-0">
                    <h4 class="mb-0">Configure details</h4>
                  </div>
                  <div class="card-body">
                    <p>All servers are behind a firewall NAT. Forward in ports
                      as needed for your applications.</p>
                    <div class="list-group list-group-flush">
                      <div class="list-group-item">
                        <div class="form-group">
                          <label for="submitAdminUser">Administrator
                            username</label>
                          <input class="form-control" type="text"
                            id="submitAdminUser" name="admin_user" required
                            value="user" disabled />
                        </div>
                        <div class="mt-3">
                          <label for="submitAdminPass"
                            class="form-label">Administrator
                            password â€” at least one symbol or number</label>
                          <input
                            class="form-control"
                            type="password"
                            id="submitAdminPass"
                            name="admin_pass"
                            required
                            placeholder="Remember to change your password when you log into your machine!" />
                        </div>
                        <div class="form-group">
                          <label for="submitHostname" class="pt-3">Name</label>
                          <input class="form-control" type="text"
                            id="submitHostname" name="hostname" required
                            placeholder="e.g. My H100cloud.com Server" />
                        </div>
                        <hr class="my-4">
                        <div class="form-group" id="configure-ports">
                          <p><b>Configure port forwards</b></p>
                          <p class="fs-10">
                            You may forward up to <span
                              id="ports-max">0</span> ports. The external port
                            is where requests will enter; the internal port is
                            where you
                            set the requests to be forwarded to. Please
                            remember to include an SSH port (<u>a port
                              forwarded to port 22</u>) so that you
                            will be able to access your instance once created.
                          </p>
                          <div class="row">
                            <div class="col-6">
                              <p>External port</p>
                            </div>
                            <div class="col-6">
                              <p>Internal port</p>
                            </div>
                          </div>
                          <div id="ports" class="checkbox"></div>
                          <div class="row mt-2">
                            <div class="input-group btn-group w-100">
                              <div class="input-group-prepend">
                                <span
                                  class="p-2 d-flex align-items-center justify-content-center input-group-text h-100 search-select btn btn-primary-soft">
                                  <i class="fas fa-plus fa-xs"
                                    aria-hidden="true"></i>
                                </span>
                              </div>
                              <select
                                class="search-select form-select py-0"
                                id="port-selector"
                                data-live-search="true"
                                data-size="5"
                                data-width="100%"
                                title="Add a new port..."></select>
                            </div>
                            <div class="col-6"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <a data-toggle="collapse" href="#advancedOptionsCollapse"
                      role="button" aria-expanded="false"
                      aria-controls="advancedOptionsCollapse">
                      Click for more advanced options
                    </a>
                    <div class="collapse" id="advancedOptionsCollapse">
                      <br />
                      <div class="form-group">
                        <label for="cloudinit">Cloudinit Script</label>
                        <textarea
                          class="form-control"
                          id="submitCloudinit"
                          name="cloudinit"
                          value
                          placeholder="write_files:&#10;  - path: /home/user/cloudinit_website/index.html&#10;    permissions: '0777'&#10;    content: |&#10;      Woohoo! This site is working!&#10;    owner: user:user &#10;runcmd:&#10;  - docker run -d --restart unless-stopped --stop-timeout 300 -v /home/user/cloudinit_website:/usr/share/nginx/html:ro -p 80:80 --name default_container nginx"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-auto pr-4 pb-5">
                <div class="sticky-top">
                  <div class="card shadow pt-4 p-3 text-dark" id="cart">
                    <h4>Your Server</h4>
                    <p id="price-summary-text" class="fs-10">
                      Pricing details will appear once you select a <br>
                      configuration.
                    </p>
                    <div id="price-summary">
                      <p class="fs-10">
                        Your actual charge will be pro-rated to the <br />
                        millisecond your server is deployed.
                      </p>
                      <div id="serverDetails" class="d-none">
                        <hr>
                        <p class="mb-2">
                          <span id="summaryGPUCount"></span>x
                          <span id="summaryGPUModel"></span>
                        </p>
                        <p class="mb-2">
                          <span id="summaryRAM"></span> GB DDR5 ECC RAM
                        </p>
                        <p class="mb-2">
                          <span id="summaryvCPU"></span> Intel Platinum 8470
                          vCPUs
                        </p>
                        <p class="mb-2">
                          <span id="summaryStorageSpace"></span> GB
                          <span id="summaryStorageClass">NVMe SSD</span>
                        </p>
                        <p class="mb-2">
                          <span id="summaryOS"></span>
                        </p>
                        <p class="mb-2">
                          <span id="summaryLocation">Dallas, Texas&nbsp;
                            <span class="badge badge-subtle-primary">Tier 3
                              Data
                              Center</span>
                          </span>
                        </p>
                        <hr />
                        <div class="row">
                          <div class="col-8">
                            <p class="mb-1 fw-bold">Running Cost</p>
                          </div>
                          <div class="col-4">
                            <p class="mb-1 fw-bold">$<span
                                id="summaryTotalPrice"></span>/hr</p>
                          </div>
                        </div>
                        <p class="fs-10">
                          Cost per hour when the VM is
                          running.
                        </p>
                        <div class="row">
                          <div class="col-8">
                            <p class="fw-bold mb-1">Stopped Cost</p>
                          </div>
                          <div class="col-4">
                            <p class="fw-bold mb-1">$<span
                                id="summaryOffPrice"></span>/hr</p>
                          </div>
                        </div>
                        <p class="fs-10">
                          Stopped VMs incur reduced storage fees, but
                          <br>the availability of GPUs on the same node<br> is
                          not
                          guaranteed.
                        </p>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col-8">
                        <p class="fw-bold">Account Balance</p>
                      </div>
                      <div class="col-4">
                        <p class="fw-bold mb-0">$<span
                            id="summaryAccountBalance">...</span></p>
                      </div>
                    </div>
                    <p class="fs-10">Deposit more funds <a
                        class="btn btn-link border btn-sm py-1"
                        href="/account">
                        here
                      </a></p>

                    <hr />
                    <p class="fs-10">Email us at sales@h100cloud.com if you
                      are<br>
                      interested in committing to a monthly or longer<br>
                      contract.
                      Save up to 30% </p>
                    <div id="authContent">
                      <div id="deployBtnParent" class="w-100">
                        <a
                          class="btn btn-falcon-primary btn-lg w-100 p-3 fs-9"
                          href="/login">Fetching account...</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <script>
  var selectedGPUAmount = 0;
  var selectedGPUModel = '';
  var selectedRAMAmount = 0;
  var selectedVCPUAmount = 0;
  var selectedStorageSpaceAmount = 0;
  var selectedOS = 'Ubuntu 22.04 LTS';
  var selectedHostnode = null;
  var hostnodes = {};

  const baseUrl = 'http://127.0.0.1:5000';

  // Define configurations here!
  var validConfigurations = [
    {gpu_count: 1, gpu_model: 'h100-sxm5-80gb', ram: 62, vcpu: 12, storage: 600, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 1, gpu_model: 'h100-sxm5-80gb', ram: 124, vcpu: 24, storage: 1200, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 2, gpu_model: 'h100-sxm5-80gb', ram: 124, vcpu: 24, storage: 1200, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 2, gpu_model: 'h100-sxm5-80gb', ram: 248, vcpu: 48, storage: 2400, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 4, gpu_model: 'h100-sxm5-80gb', ram: 248, vcpu: 48, storage: 2400, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 4, gpu_model: 'h100-sxm5-80gb', ram: 496, vcpu: 96, storage: 4800, nvlink: false, bandwidth: 10, stock: false, hostnode: null, price: 0},
    {gpu_count: 8, gpu_model: 'h100-sxm5-80gb', ram: 496, vcpu: 96, storage: 4800, nvlink: true, bandwidth: 100, stock: false, hostnode: null, price: 0},
    {gpu_count: 8, gpu_model: 'h100-sxm5-80gb', ram: 906, vcpu: 208, storage: 11680, nvlink: true, bandwidth: 100, stock: false, hostnode: null, price: 0},
  ];
  
  function populateConfigs(){
    document.getElementById('configurationSelectBox').innerHTML = '';
    for (let i = 0; i < validConfigurations.length; i++) {
      if(validConfigurations[i].stock === false){
        continue;
      }
      let configuration = validConfigurations[i];
      let gpuCount = configuration.gpu_count;
      let gpuModel = configuration.gpu_model.replace("h100", "H100").replace("-sxm5-", " SXM5 ").replace("gb", "GB");
      let ram = configuration.ram;
      let vcpu = configuration.vcpu;
      let storage = configuration.storage;
      let bandwidth = configuration.bandwidth;
      let nvlink = configuration.nvlink;

      let card = document.createElement('a');
      card.classList.add('card', 'shadow', 'text-dark', 'bg-light', 'w-100', 'gpu-select', 'mb-3');
      card.dataset.gpuCount = gpuCount;
      card.dataset.gpuModel = gpuModel;
      card.dataset.storage = storage;
      card.dataset.hostnode = configuration.hostnode;
      card.dataset.ram = ram;
      card.dataset.vcpu = vcpu;
      card.dataset.price = configuration.price;
      card.href = "javascript:void(0);";
      card.onclick = function() {
        // Select the card and update the selected configuration
        let cards = document.getElementsByClassName('gpu-select');
        for (let j = 0; j < cards.length; j++) {
          cards[j].classList.replace('bg-dark', 'bg-light');
          cards[j].classList.replace('text-light', 'text-dark');
          cards[j].children[0].children[0].children[1].children[0].classList.replace('text-300', 'text-900');
          cards[j].children[0].children[0].children[0].children[0].classList.replace('text-200', 'text-900');
        }
        this.classList.replace('bg-light', 'bg-dark');
        this.classList.replace('text-dark', 'text-light');
        this.children[0].children[0].children[1].children[0].classList.replace('text-900', 'text-300');
        this.children[0].children[0].children[0].children[0].classList.replace('text-900', 'text-200');

        selectedGPUAmount = this.dataset.gpuCount;
        selectedGPUModel = this.dataset.gpuModel;
        selectedRAMAmount = this.dataset.ram;
        selectedVCPUAmount = this.dataset.vcpu;
        selectedStorageSpaceAmount = this.dataset.storage;
        selectedHostnode = this.dataset.hostnode;

        document.getElementById('serverDetails').classList.remove('d-none');
        document.getElementById('summaryGPUCount').innerText = selectedGPUAmount;
        document.getElementById('summaryGPUModel').innerText = selectedGPUModel;
        document.getElementById('summaryRAM').innerText = selectedRAMAmount;
        document.getElementById('summaryvCPU').innerText = selectedVCPUAmount;
        document.getElementById('summaryStorageSpace').innerText = selectedStorageSpaceAmount;
        document.getElementById('summaryTotalPrice').innerText = configuration.price.toFixed(2);
        document.getElementById('summaryOffPrice').innerText = (selectedStorageSpaceAmount * 0.0001).toFixed(2);

        updatePorts(hostnodes[selectedHostnode]);
      };
      let nvswitchBanner = nvlink ? `<span class="badge badge-subtle-primary">GPU-to-GPU NVSwitch Fabric</span>` : '';
      card.innerHTML = `
        <div class="card-body">
          <div class="row">
            <div class="col">
              <h5 class="text-900">${gpuCount}x ${gpuModel}&nbsp;&nbsp;${nvswitchBanner}</h5>
              <p class="fs-10 my-1">
                ${vcpu} vCPUs, Intel Xeon Platinum 8470 @ 3.8 GHz boost &nbsp;&bull;&nbsp; ${ram} GB DDR5 &nbsp;&bull;&nbsp; ${storage} GB NVMe SSD &nbsp;&bull;&nbsp; ${bandwidth} Gbps &nbsp;&bull;&nbsp; Dallas, Texas
              </p>
            </div>
            <div class="col-auto d-flex">
              <p class="h3 my-auto text-900">$${configuration.price.toFixed(2)}/hr</p>
            </div>
          </div>
        </div>
      `;
      card.addEventListener('click', () => {
        selectedGPU = gpuModel;
        selectedGPUAmount = gpuCount;
        selectedRAMAmount = ram;
        selectedVCPUAmount = vcpu;
        selectedStorageSpaceAmount = storage;
        selectedBid = 0;
      });
      document.getElementById('configurationSelectBox').appendChild(card);
    }
  }

  async function retrieveStock(){
    const stockRequestParams = new URLSearchParams({
      minGPUCount: 1,
      minRAM: 64,
      minvCPUs: 16,
      minStorage: 600,
      minVRAM: 80,
      requiresRTX: false,
      domain: "h100cloud.com",
    });

    let saveRAMAmount = 64;
    let saveCPUAmount = 16;
    let saveStorageAmount = 600;

    const request = await fetch(`${baseUrl}/api/v0/client/deploy/hostnodes?${stockRequestParams}`);

    hostnodes = await request.json();
    hostnodes = hostnodes.hostnodes;
    // Fill in validConfigurations with the best hostnode for each configuration, and change the stock status to true
    // Prioritize filling in nodes that have fewer than 8 GPUs available for each configuration option; the goal is to fill in the nodes with the fewest GPUs first
    for (let i = 0; i < validConfigurations.length; i++) {
      let configuration = validConfigurations[i];
      let gpuCount = configuration.gpu_count;
      let ram = configuration.ram;
      let vcpu = configuration.vcpu;
      let storage = configuration.storage;

      var bestHostnode = null;
      var bestHostnodeConfig = null;
      var bestHostnodePrice = -1;
      for (const [hostnodeID, hostnode] of Object.entries(hostnodes)) {
        if(hostnode.specs.gpu[configuration.gpu_model].amount < gpuCount || 
        hostnode.specs.ram.amount < ram || (hostnode.specs.ram.amount - ram - saveRAMAmount * (hostnode.specs.gpu[configuration.gpu_model].amount - gpuCount)) < 0 || 
        hostnode.specs.cpu.amount < vcpu || (hostnode.specs.cpu.amount - vcpu - saveCPUAmount * (hostnode.specs.gpu[configuration.gpu_model].amount - gpuCount)) < 0 ||
        hostnode.specs.storage.amount < storage || (hostnode.specs.storage.amount - storage - saveStorageAmount * (hostnode.specs.gpu[configuration.gpu_model].amount - gpuCount)) < 0){
          continue;
        }
        if(!bestHostnode){
          bestHostnode = hostnodeID; 
          bestHostnodeConfig = hostnode;
          bestHostnodePrice = roundValue(hostnode.specs.ram.price * ram + hostnode.specs.cpu.price * vcpu + hostnode.specs.storage.price * storage + hostnode.specs.gpu[configuration.gpu_model].price * gpuCount);
        }

        if ((roundValue(hostnode.specs.ram.price * ram + hostnode.specs.cpu.price * vcpu + hostnode.specs.storage.price * storage + hostnode.specs.gpu[configuration.gpu_model].price * gpuCount) < bestHostnodePrice) || 
        (hostnode.specs.gpu[configuration.gpu_model].amount < bestHostnodeConfig.specs.gpu[configuration.gpu_model].amount &&
         hostnode.specs.gpu[configuration.gpu_model].amount >= gpuCount && 
         hostnode.specs.ram.amount >= ram && 
         hostnode.specs.cpu.amount >= vcpu && 
         hostnode.specs.storage.amount >= storage && roundValue(hostnode.specs.ram.price * ram + hostnode.specs.cpu.price * vcpu + hostnode.specs.storage.price * storage + hostnode.specs.gpu[configuration.gpu_model].price * gpuCount) <= bestHostnodePrice)) {
          bestHostnode = hostnodeID;
          bestHostnodeConfig = hostnode;
          bestHostnodePrice = roundValue(hostnode.specs.ram.price * ram + hostnode.specs.cpu.price * vcpu + hostnode.specs.storage.price * storage + hostnode.specs.gpu[configuration.gpu_model].price * gpuCount);
        }
      }

      if (bestHostnode) {
        validConfigurations[i].hostnode = bestHostnode;
        validConfigurations[i].stock = true;
        validConfigurations[i].price = bestHostnodePrice;
      }
    }
    populateConfigs();
  }

  retrieveStock();


  const osMappings = {
    "Ubuntu 20.04 LTS": "Ubuntu 20.04 LTS",
    "Ubuntu 22.04 LTS": "Ubuntu 22.04 LTS",
    "TensorML 20.04 LTS TensorFlow": "TensorML 20 TensorFlow",
    "TensorML 20.04 LTS PyTorch": "TensorML 20 PyTorch",
    "TensorML 20.04 LTS Everything": "TensorML 20 Everything",
    "TensorML 20.04 LTS RAPIDS": "TensorML 20 RAPIDS",
  };

  function roundValue(value) {
    return Math.round(value * 100) / 100;
  }

  function checkPassword(password) {
    // Password has to be at least 8 characters with at least 1 uppercase letter, symbol, or number.
    return (
      password.length >= 8 &&
      (/[A-Z]/.test(password) || /[\W_]/.test(password) || /\d/.test(password))
    );
  }

  function removePort(port) {
    // Remove port configuration
    document.getElementById(`port-${port}-row`).remove();

    // Make port option selectable
    document
      .getElementById(`port-selector-${port}`)
      .removeAttribute("disabled");
  }

  function addPort(port, defaultOutput = "") {
    // Disable port selection
    document.getElementById(`port-selector-${port}`).disabled = true;

    // Add port to list
    const portConfiguration = document.createElement("div");

    portConfiguration.innerHTML = `
      <div class="row mt-2 port-checkbox" id="port-${port}-row" data-port="${port}">
        <div class="col-6">
          <div class="btn-group">
            <button
              type="button"
              id="port-${port}"
              aria-label="Close"
              class="btn btn-danger-soft px-2 py-0 port-close"
              value="${port}"
              onclick="removePort(${port})"
            >
              <i class="fas fa-times fa-xs" aria-hidden="true"></i>
            </button>
            <button class="btn py-0" type="button" disabled>
              ${port}
            </button></button>
          </div>
        </div>
        <div class="col-6">
          <input
            type="number"
            class="col-6 form-control port-forward py-0"
            max="65535"
            min="1"
            id="outputport-${port}"
            value="${defaultOutput}"
          />
        </div>
      </div>`;

    document.getElementById("ports").appendChild(portConfiguration);
  }

  
  function updatePorts(hostnode) {
    // Clear ports
    document.getElementById("ports").innerHTML = "";
    document.getElementById("port-selector").innerHTML = "";

    // Set maximum ports
    const { ports } = hostnode.networking;
    document.getElementById("ports-max").innerHTML = ports.length;

    ports.forEach((port, index) => {
      // Add port selection options
      const portOption = document.createElement("option");

      portOption.setAttribute("id", `port-selector-${port}`);
      portOption.setAttribute("value", port);
      portOption.innerHTML = port;

      // Add port configuration elements
      document.getElementById("port-selector").appendChild(portOption);

      const defaultOutputPort = [22, 3389, 8888][index];

      if (index < 3) addPort(port, defaultOutputPort);
    });
  }

  function calculateTotalPrice(specs) {
    const { gpuTotal, ramTotal, cpuTotal, storageTotal, total } =
      calculateVMPrice(specs);

    totalPriceGPU = formatLineItem(gpuTotal);
    totalPriceRAM = formatLineItem(ramTotal);
    totalPriceVCPU = formatLineItem(cpuTotal);
    totalPriceStorage = formatLineItem(storageTotal);

    const totalPrice = formatLineItem(total);

    // Set subtotals
    document.getElementById("summaryGPUTotalPrice").innerHTML = totalPriceGPU;
    document.getElementById("summaryRAMPrice").innerHTML = totalPriceRAM;
    document.getElementById("summaryvCPUPrice").innerHTML = totalPriceVCPU;
    document.getElementById("summaryStoragePrice").innerHTML =
      totalPriceStorage;

    document.getElementById("summaryTotalPrice").innerHTML = totalPrice;
    document.getElementById("summaryOffPrice").innerHTML = totalPriceStorage;
  }

  async function deployServer(redirected, split_url) {
    let sendAdminUser;
    let sendAdminPass;
    let sendHostname;
    let sendCloudinit;
    let externalPorts = [];
    let internalPorts = [];

    document.getElementById("deployBtnParent").innerHTML = `
    <button class="btn btn-falcon-primary w-100 lift btn-lg d-flex align-items-center justify-content-center" type="button" disabled>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="margin-right: 7px"></span>
        <span>Deploying...</span>
    </button>
    `;

    Array.from(document.getElementsByClassName("port-checkbox")).forEach((element) => {
      const externalPort = parseInt(element.getAttribute("data-port"));

      externalPorts.push(externalPort);

      const internalPort = parseInt(
        document.getElementById(`outputport-${externalPort}`).value
      );
      internalPorts.push(internalPort);
    });

    sendAdminUser = document.getElementById("submitAdminUser").value;
    sendAdminPass = document.getElementById("submitAdminPass").value;
    sendHostname = document.getElementById("submitHostname").value;
    sendCloudinit = document.getElementById("submitCloudinit").value;

    // Validation
    if (!selectedGPU) {
        showMessage("Please select a graphics card to provision.", true);
        return;
      }

      if (!selectedLocation) {
        showMessage("Please select a location.", true);
        return;
      }

      if (parseInt("{{account_amount_deployed}}") + selectedGPUAmount > parseInt("{{account_amount_limit}}") && "{{logged_in}}" == "True") {
        alert("Please contact us at support@tensordock.com to increase your account's GPU limit, which is currently {{account_amount_limit}}.");
        return;
      }

      if (!sendAdminUser) {
        alert("Please define the administrator username.");
        return;
      }

      if (sendAdminPass && !checkPassword(sendAdminPass)) {
        alert("Make sure the administrator password is at least 8 characters long and contains at least 1 uppercase letter, symbol, or number.");
        return;
      }

      if (selectedLocation.type === "local" && (!externalPorts.length || !internalPorts.filter((port) => port).length)) {
        alert("Please configure external and internal ports.");
        return;
      }

      if (!sendHostname) {
        alert("Please define the server's hostname.");
        return;
      }

      if (selectedOS === "Windows 10" && selectedStorageSpaceAmount < 90) {
        alert("Please ensure you have enough storage space (90 GB) for our Windows 10 operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS RAPIDS" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS RAPIDS operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS TensorFlow" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS TensorFlow operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS PyTorch" && selectedStorageSpaceAmount < 40) {
        alert("Please ensure you have enough storage space (40 GB) for our TensorML 20.04 LTS PyTorch operating system template.");
        return;
      }

      if (selectedOS === "TensorML 20.04 LTS Everything" && selectedStorageSpaceAmount < 60) {
        alert("Please ensure you have enough storage space (60 GB) for our TensorML 20.04 LTS Everything operating system template.");
        return;
      }

    const apiRoute = "http://localhost:5000/api/v0/client/deploy/single";

    const body = {
      deployment_type: selectedLocation.type,
      ...(sendAdminPass && { password: sendAdminPass }),
      name: sendHostname,
      vcpus: selectedVCPUAmount,
      storage: selectedStorageSpaceAmount,
      ram: selectedRAMAmount,
      country: "United States",
      gpu_count: selectedGPUAmount,
      gpu_model: gpuMappings[selectedGPU],
      operating_system: osMappings[selectedOS],
      ...(selectedLocation.type === "local" && {
        hostnode: selectedHostnode.id,
        external_ports: `[${externalPorts.join(', ')}]`,
        internal_ports: `[${internalPorts.join(', ')}]`,
      }),
      ...(selectedLocation.type === "network" && {
        location: selectedLocation.location,
      }),
      ...(sendCloudinit && {
        cloudinit_script: sendCloudinit,
      }),
      ...(selectedBid && {
        price_type: "spot",
        price: selectedBid,
      }),
    };

    const formData = new FormData();

    Object.keys(body).forEach((key) => {
      const value = body[key];
      formData.append(key, value);
    });

    const whitelabelToken = document.cookie.split('; ').find(row => row.startsWith('whitelabelToken='));

    const request = await fetch(apiRoute, {
      method: "POST",
      body: formData,
      credentials: "include",
      headers: {
        'Authorization': whitelabelToken.split('=')[1],
      },
    });

    const response = await request.json();

    if (response.success) {
      window.location.href = '/list';
      showMessage("Successfully deployed!", false);
    } else {
      showMessage(
        `${response.error} There was an error deploying your server.`, true
      );

      document.getElementById("deployBtnParent").innerHTML =
        '<a class="btn btn-falcon-primary w-100 lift btn-lg" href="javascript:deployServer(true, null)">Deploy Server</a>';
    }
  }

  async function updateSSHKeys() {
    const sshKeys = document.getElementById("sshKeys").value;
    const apiRoute = "/ssh_public_keys";
    const body = { ssh_keys: sshKeys };

    const request = await fetch(apiRoute, {
      method: "POST",
      body: JSON.stringify(body),
      headers: {
        Accept: "application/json",
        "Content-Type": "application/json",
      },
    });

    const response = await request.json();

    if (response.status === 'success') showSuccess("Updated SSH public keys successfully.");
    else showError("Failed to update SSH public keys. Try logging in again.");
  }

  $("#port-selector").on("change", (e) => addPort(e.target.value));

const checkLoggedIn = async () => {
  let loggedIn = false;
  var whitelabelToken = "";
  for(const cookie of document.cookie.split('; ')){
    if(cookie.startsWith('whitelabelToken=')){
      whitelabelToken = cookie.split('=')[1];
    }
  }

  if (whitelabelToken) {
    try {
      const response = await fetch(`${baseUrl}/api/v0/client/whitelabel/token_verify`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': whitelabelToken,
        }
      });
      if (response.ok) {
        const tokenVerifyResponse = await response.json();
        loggedIn = true;
      }
    } catch (error) {
      console.error("Error verifying token:", error);
    }
  }

  return loggedIn;
}

document.addEventListener('DOMContentLoaded', async () => {
  async function getAccountFunds() {

      var whitelabelToken = "";
      for(const cookie of document.cookie.split('; ')){
        if(cookie.startsWith('whitelabelToken=')){
          whitelabelToken = cookie.split('=')[1];
        }
      }

      if(!whitelabelToken){
        return 0;
      }

      try {
        const response = await fetch(`${baseUrl}/api/vO/client/whitelabel/getUserInfo`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': whitelabelToken,
          },
        });

        if (response.ok) {
          const userInquiryResponse = await response.json();
          return userInquiryResponse.balance;

        }
      } catch (error) {
        console.error("Error verifying token:", error);
        showMessage("Error retrieving account information", true);
        return "Error getting information";
      }
    };

  const balance = await getAccountFunds();
  const loggedIn = await checkLoggedIn();
  const authContent = document.getElementById('authContent');
  const dropdownUser = document.getElementById('navbarDropdownUser');

  if (!loggedIn) {
    authContent.innerHTML = `
      <div id="redirectBtnParent" class="w-100">
        <a href="/login" class="btn btn-falcon-primary w-100 lift btn-lg fs-9 p-3">
          Login to Deploy Server
        </a>
      </div>`;
      dropdownUser.style.display = 'none';
  } else if (balance > 0) {
      authContent.innerHTML = `
      <div id="deployBtnParent" class="w-100">
        <a class="btn btn-falcon-primary w-100 lift btn-lg fs-9 p-3" href="javascript:deployServer(true, null)">
          Deploy Server
        </a>
      </div>`;
      document.getElementById('summaryAccountBalance').innerHTML = balance.toFixed(2);
      document.getElementById('headerAccountBalance').innerHTML = balance.toFixed(2); 
  } else if (balance <= 0){
    authContent.innerHTML = `
      <div id="depositBtnParent" class="w-100">
        <a class="btn btn-falcon-primary w-100 lift btn-lg fs-9 p-3" href="/account">
          Balance of $${balance.toFixed(2)} too low
        </a>
      </div>`;
      document.getElementById('summaryAccountBalance').innerHTML = balance.toFixed(2);
      document.getElementById('headerAccountBalance').innerHTML = balance.toFixed(2); 
  }
});
</script>
      </div>
    </main>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"></script>
  </body>
</html>